---
import SliderButton from "./Slider-button.astro";

const slidersData = [
    {
        title: 'Hola mundo 1',
        description: 'Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto. Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.',
        image: '/descargar.jpg'
    },
    {
        title: 'Hola mundo 2',
        description: 'Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.',
        image: '/descar.jpg'
    },
    {
        title: 'Hola mundo 3',
        description: 'Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.',
        image: '/descar2.jpg'
    }
]
---

<div id="indicators-carousel" class="relative w-full" data-carousel="slide">
    <!-- Carousel wrapper -->
    <div class="relative h-screen overflow-hidden rounded-lg">
        <!-- Item 1 -->
        <div class="duration-700 ease-in-out" data-carousel-item="active">
            <img src="/descargar.jpg" class="absolute w-full h-full object-cover" alt="Imagen 1">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-center p-4 rounded overflow-hidden flex flex-col items-center justify-center max-w-xl">
                <h1 class="text-3xl font-bold">Hola mundo 1</h1>
                <p class="text-xl mb-2">Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto. Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.</p>
                <SliderButton />
            </div>
        </div>
        <!-- Item 2 -->
        <div class="hidden duration-700 ease-in-out" data-carousel-item>
            <img src="/descar.jpg" class="absolute w-full h-full object-cover" alt="Imagen 2">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white bg-opacity-70 text-center p-4 rounded overflow-hidden flex flex-col items-center justify-center max-w-xl">
                <h1 class="text-3xl font-bold">Hola munto 2</h1>
                <p class="text-xl mb-2">Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.</p>
                <SliderButton />
            </div>
        </div>
        <!-- Item 3 -->
        <div class="hidden duration-700 ease-in-out" data-carousel-item>
            <img src="/descar2.jpg" class="absolute w-full h-full object-cover" alt="Imagen 3">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white bg-opacity-70 p-4 rounded overflow-hidden flex flex-col items-center justify-center max-w-xl">
                <h2 class="text-3xl font-bold">Hola munto 3</h2>
                <p class="text-xl mb-2">Lorem Ipsum es simplemente el texto de relleno de las imprentas y archivos de texto.</p>
                <SliderButton />
            </div>
        </div>
    </div>
    <!-- Slider indicators -->
    <div class="absolute z-30 flex -translate-x-1/2 space-x-3 bottom-5 left-1/2">
        {
          slidersData.map((_, index) => (
            <button type="button" class=`w-3 h-3 rounded-full bg-amber-100 ${index === 0 && 'bg-red-500'}` aria-current=`${index === 0 ? 'true' : 'false'}` aria-label=`Slide ${index + 1}` data-carousel-slide-to={index}></button>
          ))
        }
    </div>
    <!-- Slider controls -->
    <button type="button" class="absolute top-0 left-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group" data-carousel-prev>
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 group-hover:bg-white/50">
            <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1L1 5l4 4"/>
            </svg>
            <span class="sr-only">Previous</span>
        </span>
    </button>
    <button type="button" class="absolute top-0 right-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group" data-carousel-next>
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 group-hover:bg-white/50">
            <svg class="w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 9l4-4-4-4"/>
            </svg>
            <span class="sr-only">Next</span>
        </span>
    </button>
</div>

<script>
    const items = document.querySelectorAll('[data-carousel-item]') as NodeListOf<HTMLElement>;
    const indicators = document.querySelectorAll('[data-carousel-slide-to]') as NodeListOf<HTMLElement>;
    let currentIndex = 0;
    let autoChange: number;

    function hiddenIndicators(index: number) {
        indicators.forEach((indicator, i) => {
            if (i === index) return;
            indicator.setAttribute('aria-current', 'false');
            indicator.classList.remove('bg-red-500');
        });
    }

    function hiddenItems(index: number) {
        items.forEach((item, i) => {
            if (i === index) return;
            item.classList.add('hidden');
        });
    }

    function showImage(index: number) {
        if (items.length === 0 || indicators.length === 0) return;
        hiddenIndicators(index);
        hiddenItems(index);

        currentIndex = index;
        items[index].classList.remove('hidden');
        indicators[index].setAttribute('aria-current', 'true');
        indicators[index].classList.add('bg-red-500');
    }

    function showNextImage() {
        showImage((currentIndex + 1) % items.length);
    }

    function startAutoChange() {
        autoChange = window.setInterval(showNextImage, 3000);
    }

    function stopAutoChange() {
        window.clearInterval(autoChange);
    }

    startAutoChange();

    const prevButton = document.querySelector('[data-carousel-prev]') as HTMLElement | null;
    const nextButton = document.querySelector('[data-carousel-next]') as HTMLElement | null;

    prevButton?.addEventListener('click', () => {
        showImage((currentIndex - 1 + items.length) % items.length);
        stopAutoChange();
        startAutoChange();
    });

    nextButton?.addEventListener('click', () => {
        showNextImage();
        stopAutoChange();
        startAutoChange();
    });

    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            showImage(index);
            stopAutoChange();
            startAutoChange();
        });
    });
</script>